
# ğŸ–¼ï¸ åŸºäº NumPy çš„ Vision Transformer å›¾åƒæ£€ç´¢ç³»ç»Ÿ

> ä¸€ä¸ªè½»é‡çº§ã€æ•™è‚²æ€§çš„å›¾åƒæ£€ç´¢å¼•æ“ï¼Œä½¿ç”¨ **NumPy** å’Œ **DINOv2** ä»é›¶å®ç°ï¼Œå¹¶é…å¤‡ **Streamlit** Web äº¤äº’ç•Œé¢ã€‚

![Python](https://img.shields.io/badge/Python-3.8%2B-blue)
![NumPy](https://img.shields.io/badge/Library-NumPy-orange)
![Streamlit](https://img.shields.io/badge/Frontend-Streamlit-red)
![License](https://img.shields.io/badge/License-MIT-green)

## ğŸ“– é¡¹ç›®ç®€ä»‹ (Introduction)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºå†…å®¹çš„å›¾åƒæ£€ç´¢ç³»ç»Ÿ (CBIR)ï¼Œæ—¨åœ¨æ¼”ç¤º Vision Transformer (ViT) çš„å†…éƒ¨å·¥ä½œåŸç†ã€‚ä¸ä¾èµ–æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚ PyTorch/TensorFlowï¼‰è¿›è¡Œæ¨ç†çš„ä¼ ç»Ÿå®ç°ä¸åŒï¼Œæœ¬é¡¹ç›®ä»…ä½¿ç”¨çº¯ **NumPy** æ‰‹åŠ¨é‡æ„äº† **DINOv2-Base** æ¨¡å‹ã€‚

ç”¨æˆ·å¯ä»¥ä¸Šä¼ ä¸€å¼ æŸ¥è¯¢å›¾åƒï¼Œç³»ç»Ÿå°†å®æ—¶ä»æœ¬åœ°å›¾åº“ä¸­æ£€ç´¢å‡ºè¯­ä¹‰ç›¸ä¼¼çš„å›¾åƒã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§
* **é›¶æ¡†æ¶æ¨ç† (Zero-Framework Inference)**: Transformer çš„å®Œæ•´å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼ˆPatch Embedding, Multi-Head Attention, MLPï¼‰å®Œå…¨ç”± `numpy` å®ç°ã€‚
* **é«˜æ€§èƒ½ç´¢å¼•**: é«˜æ•ˆç®¡ç†åŒ…å« 10,000+ å¼ å›¾åƒçš„å›¾åº“ã€‚
* **æ•°å­¦çº§ç²¾åº¦**: ä¸å®˜æ–¹ PyTorch æƒé‡è¿›è¡Œé€å±‚å¯¹æ¯”éªŒè¯ï¼Œè¯¯å·®èŒƒå›´æ§åˆ¶åœ¨ $< 1e^{-15}$ ä»¥å†…ï¼ˆæ•°å­¦ç­‰ä»·ï¼‰ã€‚
* **äº¤äº’å¼ UI**: åŸºäº Streamlit æ„å»ºçš„ç”¨æˆ·å‹å¥½å‹ Web ç•Œé¢ï¼Œæ”¯æŒå®æ—¶å¯è§†åŒ–ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ (System Architecture)

ç³»ç»Ÿä¸»è¦ç”±ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š
1.  **é¢„å¤„ç† (Preprocessing)**: å›¾åƒç¼©æ”¾ä¸ Patch å¯¹é½ï¼ˆé€‚é… $14 \times 14$ ç½‘æ ¼ï¼‰ã€‚
2.  **æ¨¡å‹æ¨ç† (Model Inference)**: ä½¿ç”¨è‡ªå®šä¹‰ NumPy ViT æå– 768 ç»´ç‰¹å¾å‘é‡ã€‚
3.  **æ£€ç´¢å¼•æ“ (Retrieval Engine)**: è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ (Cosine Similarity) å¹¶è¿”å› Top-K åŒ¹é…ç»“æœã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Getting Started)

### 1. ç¯å¢ƒè¦æ±‚
ç¡®ä¿å·²å®‰è£… Python 3.8+ã€‚å»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚


# å…‹éš†ä»“åº“
git clone [https://github.com/your-username/your-repo-name.git](https://github.com/your-username/your-repo-name.git)

```bash
cd your-repo-name
```
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

### 2. ä¸‹è½½æ•°æ®ä¸æƒé‡

è¿è¡Œè„šæœ¬ä¸‹è½½æ¼”ç¤ºå›¾åº“å’Œè½¬æ¢åçš„æ¨¡å‹æƒé‡ã€‚

```bash
python step1_download.py

```

* *åŠŸèƒ½ï¼šä¸‹è½½ 10k+ å¼ å›¾ç‰‡åˆ° `./gallery` ç›®å½•ï¼Œå¹¶ä¸‹è½½ `dinov2_base.npz`ï¼ˆNumPy å…¼å®¹æƒé‡ï¼‰ã€‚*

### 3. æ„å»ºç´¢å¼• (ç¦»çº¿)

æå–å›¾åº“ä¸­æ‰€æœ‰å›¾åƒçš„ç‰¹å¾ï¼Œæ„å»ºæœç´¢ç´¢å¼•ã€‚

```bash
python step2_build_index.py

```

* *è¾“å‡ºï¼š`index.npy` (ç‰¹å¾æ•°æ®åº“æ–‡ä»¶)ã€‚*

### 4. è¿è¡Œåº”ç”¨

å¯åŠ¨ Web äº¤äº’ç•Œé¢ã€‚

```bash
streamlit run app.py

```

* *æµè§ˆå™¨å°†è‡ªåŠ¨æ‰“å¼€ `http://localhost:8501`ã€‚*

---

## ğŸ•¹ï¸ ä½¿ç”¨æŒ‡å— (User Guide)

ç³»ç»Ÿå¯åŠ¨åï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. **ä¸Šä¼ æŸ¥è¯¢å›¾åƒ (Upload Query)**:
* åœ¨å·¦ä¾§è¾¹æ  (Sidebar) æ‰¾åˆ° **"Upload an image"** åŒºåŸŸã€‚
* ç‚¹å‡» **"Browse files"** æŒ‰é’®ï¼Œé€‰æ‹©ä¸€å¼ æœ¬åœ°å›¾ç‰‡ï¼ˆæ”¯æŒ JPG/PNG æ ¼å¼ï¼‰ã€‚
* *å»ºè®®å°è¯•ä¸åŒç±»åˆ«çš„å›¾ç‰‡ï¼Œå¦‚çŒ«ã€ç‹—ã€æ±½è½¦æˆ–èŠ±å‰ï¼Œä»¥æµ‹è¯•è¯­ä¹‰æ£€ç´¢èƒ½åŠ›ã€‚*


2. **è°ƒæ•´æ£€ç´¢å‚æ•° (Settings)**:
* ä½¿ç”¨å·¦ä¾§çš„ **"Top-K Results"** æ»‘å—ã€‚
* æ‚¨å¯ä»¥æŒ‡å®šè¿”å›æœ€ç›¸ä¼¼å›¾ç‰‡çš„æ•°é‡ï¼ˆä¾‹å¦‚ï¼šå‰ 5 å¼ æˆ–å‰ 10 å¼ ï¼‰ã€‚


3. **æŸ¥çœ‹æ£€ç´¢ç»“æœ (View Results)**:
* å³ä¾§ä¸»ç•Œé¢å°†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
* **Your Query**: æ˜¾ç¤ºæ‚¨åˆšåˆšä¸Šä¼ çš„å›¾ç‰‡ã€‚
* **Search Results**: æŒ‰ç…§ä½™å¼¦ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åˆ—çš„å›¾åº“åŒ¹é…ç»“æœã€‚





---

## ğŸ“‚ é¡¹ç›®ç»“æ„ (Project Structure)

```text
.
â”œâ”€â”€ gallery/                # å›¾åƒæ•°æ®é›†æ–‡ä»¶å¤¹
â”œâ”€â”€ models/                 # æ¨¡å‹æƒé‡æ–‡ä»¶ (.npz)
â”œâ”€â”€ app.py                  # Streamlit Web åº”ç”¨ç¨‹åº
â”œâ”€â”€ dinov2_numpy.py         # çº¯ NumPy å®ç°çš„æ ¸å¿ƒ ViT æ¨¡å‹
â”œâ”€â”€ preprocess_image.py     # å›¾åƒé¢„å¤„ç†é€»è¾‘
â”œâ”€â”€ step1_download.py       # æ•°æ®ä¸‹è½½è„šæœ¬
â”œâ”€â”€ step2_build_index.py    # ç´¢å¼•æ„å»ºè„šæœ¬
â”œâ”€â”€ debug.py                # æ¨¡å‹ç²¾åº¦éªŒè¯è„šæœ¬
â””â”€â”€ requirements.txt        # Python ä¾èµ–åˆ—è¡¨

```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ (Tech Stack)

* **æ ¸å¿ƒç®—æ³•**: `NumPy` (çŸ©é˜µè¿ç®—, Transformer æ•°å­¦åŸç†)
* **å›¾åƒå¤„ç†**: `Pillow` (PIL)
* **Web æ¡†æ¶**: `Streamlit`
* **æ¨¡å‹æ¶æ„**: DINOv2 (ViT-Base)

---

## ğŸ§ª æ€§èƒ½ä¸éªŒè¯ (Performance & Verification)

æˆ‘ä»¬å°† NumPy å®ç°çš„è¾“å‡ºä¸å®˜æ–¹ PyTorch æ¨¡å‹è¿›è¡Œäº†ä¸¥æ ¼å¯¹æ¯”ï¼ŒéªŒè¯ç»“æœå¦‚ä¸‹ï¼š

| æŒ‡æ ‡ | æ•°å€¼ |
| --- | --- |
| **å¹³å‡ç»å¯¹è¯¯å·® (MAE)** | `< 1e-15` (æ•°å­¦ä¸Šå®Œå…¨ç­‰ä»·) |
| **æ¨ç†æ—¶é—´ (CPU)** | `~0.15s` / æ¯å¼ å›¾ |
| **æ£€ç´¢é€Ÿåº¦** | `< 0.01s` (é’ˆå¯¹ 10k å›¾åº“) |



